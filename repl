#!/usr/bin/python3 -u

import argparse
import shlex
import sys
import subprocess

try:
    import readline
    import xdg.BaseDirectory
except ImportError:
    pass  # no readline or xdg support
else:
    import atexit
    import os
    conf = xdg.BaseDirectory.save_config_path('repl')
    histfile = os.path.join(conf, 'history')

    try:
        readline.read_history_file(histfile)
    except IOError:
        pass

    atexit.register(readline.write_history_file, histfile)


parser = argparse.ArgumentParser()
parser.add_argument('command', nargs='+')
args = parser.parse_args()

while True:
    try:
        uargs = shlex.split(input(' '.join(args.command) + '>> '))
    except EOFError:
        sys.exit(0)
    except ValueError as e:
        print(e)
        continue

    subprocess.call(args.command + uargs)
